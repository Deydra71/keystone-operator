apiVersion: v1
kind: Secret
metadata:
  name: keystone
  annotations:
    keystone.openstack.org/rotatedat: "2009-11-10T23:00:00Z"
commands:
  - script: |
      #!/bin/sh
      set -euxo pipefail
      seconds=1
      while [ $seconds -le 30 ]; do
        rotatedat=$(oc get secret keystone -n $NAMESPACE -o jsonpath="{.metadata.annotations['keystone\.openstack\.org/rotatedat']}")
        if [ $rotatedat != "2009-11-10T23:00:00Z" ]; then
          break
        fi
        sleep 1
        seconds=$(( $seconds + 1 ))
      done
      sleep 20 # make sure a rollout started
      oc rollout status deployment/keystone -n $NAMESPACE
---
apiVersion: v1
kind: Secret
metadata:
  name: keystone
  annotations:
    keystone.openstack.org/rotatedat: "2009-11-10T23:00:00Z"
commands:
  - script: |
      #!/bin/sh
      set -euxo pipefail
      seconds=1
      while [ $seconds -le 30 ]; do
        rotatedat=$(oc get secret keystone -n $NAMESPACE -o jsonpath="{.metadata.annotations['keystone\.openstack\.org/rotatedat']}")
        if [ $rotatedat != "2009-11-10T23:00:00Z" ]; then
          break
        fi
        sleep 1
        seconds=$(( $seconds + 1 ))
      done
      sleep 20 # make sure a rollout started
      oc rollout status deployment/keystone -n $NAMESPACE
---
apiVersion: v1
kind: Secret
metadata:
  name: keystone
  annotations:
    keystone.openstack.org/rotatedat: "2009-11-10T23:00:00Z"
commands:
  - script: |
      #!/bin/sh
      set -euxo pipefail
      seconds=1
      while [ $seconds -le 30 ]; do
        rotatedat=$(oc get secret keystone -n $NAMESPACE -o jsonpath="{.metadata.annotations['keystone\.openstack\.org/rotatedat']}")
        if [ $rotatedat != "2009-11-10T23:00:00Z" ]; then
          break
        fi
        sleep 1
        seconds=$(( $seconds + 1 ))
      done
      sleep 20 # make sure a rollout started
      oc rollout status deployment/keystone -n $NAMESPACE
---
apiVersion: v1
kind: Secret
metadata:
  name: keystone
  annotations:
    keystone.openstack.org/rotatedat: "2009-11-10T23:00:00Z"
commands:
  - script: |
      #!/bin/sh
      set -euxo pipefail
      seconds=1
      while [ $seconds -le 30 ]; do
        rotatedat=$(oc get secret keystone -n $NAMESPACE -o jsonpath="{.metadata.annotations['keystone\.openstack\.org/rotatedat']}")
        if [ $rotatedat != "2009-11-10T23:00:00Z" ]; then
          break
        fi
        sleep 1
        seconds=$(( $seconds + 1 ))
      done
      sleep 20 # make sure a rollout started
      oc rollout status deployment/keystone -n $NAMESPACE
---
apiVersion: v1
kind: Secret
metadata:
  name: keystone
  annotations:
    keystone.openstack.org/rotatedat: "2009-11-10T23:00:00Z"
commands:
  - script: |
      #!/bin/sh
      set -euxo pipefail
      seconds=1
      while [ $seconds -le 30 ]; do
        rotatedat=$(oc get secret keystone -n $NAMESPACE -o jsonpath="{.metadata.annotations['keystone\.openstack\.org/rotatedat']}")
        if [ $rotatedat != "2009-11-10T23:00:00Z" ]; then
          break
        fi
        sleep 1
        seconds=$(( $seconds + 1 ))
      done
      sleep 20 # make sure a rollout started
      oc rollout status deployment/keystone -n $NAMESPACE
---
apiVersion: v1
kind: Secret
metadata:
  name: keystone
  annotations:
    keystone.openstack.org/rotatedat: "2009-11-10T23:00:00Z"
commands:
  - script: |
      #!/bin/sh
      set -euxo pipefail
      seconds=1
      while [ $seconds -le 30 ]; do
        rotatedat=$(oc get secret keystone -n $NAMESPACE -o jsonpath="{.metadata.annotations['keystone\.openstack\.org/rotatedat']}")
        if [ $rotatedat != "2009-11-10T23:00:00Z" ]; then
          break
        fi
        sleep 1
        seconds=$(( $seconds + 1 ))
      done
      sleep 20 # make sure a rollout started
      oc rollout status deployment/keystone -n $NAMESPACE
